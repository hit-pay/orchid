<script setup>
import { BaseInput, Icon } from "@/orchidui";

import { computed } from "vue";

const props = defineProps({
  variant: {
    type: String,
    default: "grid",
  },
  label: String,
  hint: String,
  errorMessage: String,
  placeholder: String,
  isDisabled: Boolean,
  borderless: Boolean,
  options: Array,
  modelValue: [Array, String, Number],
  isRequired: {
    type: Boolean,
    default: false,
  },
  labelIcon: {
    type: String,
    default: "",
  },
  tooltipText: {
    type: String,
    default: "",
  },
  tooltipOptions: {
    type: Object,
    default: () => ({}),
  },
  class: String,
});

const emit = defineEmits({
  "update:modelValue": [],
});

const update = (value) => {
  emit("update:modelValue", value);
};

const isGridVariant = computed(() => {
  return props.variant === "grid";
});
</script>

<template>
  <BaseInput
    :label="label"
    :hint="hint"
    :error-message="errorMessage"
    :is-required="isRequired"
    :label-icon="labelIcon"
    :tooltip-text="tooltipText"
    :tooltip-options="tooltipOptions"
  >
    <div
      class="w-full grid gap-3"
      :class="[
        props.class,
        isGridVariant
          ? 'grid-cols-3'
          : variant === 'list2'
            ? 'grid-cols-2'
            : '',
      ]"
    >
      <div
        v-for="opt in options"
        :key="opt.value"
        class="cursor-pointer group items-start"
        :class="{
          'flex border border-oc-gray-200 p-3 rounded hover:shadow':
            !isGridVariant,
          'border-2 border-oc-primary':
            !isGridVariant && opt.value.toString() === modelValue.toString(),
          '!border-0 hover:bg-oc-accent-1-50 flex': borderless,
        }"
        @click="update(opt.value)"
      >
        <slot
          name="option"
          :option="opt"
          :selected="opt.value.toString() === modelValue.toString()"
        >
          <img
            v-if="opt.preview"
            class="group-hover:shadow rounded"
            :class="{
              'border-2 border-oc-primary':
                isGridVariant && opt.value.toString() === modelValue.toString(),
              'border border-oc-gray-200':
                (isGridVariant &&
                  opt.value.toString() !== modelValue.toString()) ||
                !isGridVariant,
              'w-full': isGridVariant,
              'w-[50px]': !isGridVariant,
            }"
            :src="opt.preview"
          />
          <div
            class="mt-2"
            :class="[
              isGridVariant ? 'text-center' : 'px-3',
              borderless ? 'flex-1' : '',
            ]"
          >
            <span
              class="font-medium text-oc-text-400 group-hover:text-oc-text-500"
              :class="{
                'text-sm ': isGridVariant,
                'text-oc-text-400 group-hover:text-oc-text-500':
                  isGridVariant &&
                  opt.value.toString() !== modelValue.toString(),
                'text-oc-text-500':
                  isGridVariant &&
                  opt.value.toString() === modelValue.toString(),
              }"
              >{{ opt.label }}</span
            >
            <div
              v-if="opt.description"
              class="flex text-sm text-oc-text-400 mt-2"
            >
              {{ opt.description }}
            </div>
          </div>
          <Icon
            v-if="borderless"
            width="16"
            height="16"
            name="check-2"
            class="text-oc-primary"
            :class="
              opt.value.toString() === modelValue.toString()
                ? 'opacity-100'
                : 'opacity-0'
            "
          />
        </slot>
      </div>
    </div>
  </BaseInput>
</template>
